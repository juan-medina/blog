<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Serverless Kotlin | Juan Medina Personal Blog</title>
  <meta name="author" content="Juan Medina">
  <meta name="description" content="Personal blog from Juan Medina">
  <meta property="og:title" content="Serverless Kotlin | Juan Medina Personal Blog">
  <meta property="og:url" content="http://juan-medina.com/2017/07/21/kotlin-serverless/">
  <meta property="og:site_name" content="Juan Medina Personal Blog">
  <meta property="og:description" content="Personal blog from Juan Medina">
  <meta property="og:image" content="http://juan-medina.com/assets/img/openwhiskkotlin.png">
  <meta property="og:type" content="blog">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:description" content="Personal blog from Juan Medina">
  <meta name="twitter:title" content="Serverless Kotlin | Juan Medina Personal Blog">
  <meta name="twitter:url" content="http://juan-medina.com/2017/07/21/kotlin-serverless/">
  <meta name="twitter:site" content="Juan Medina Personal Blog">
  <meta name="twitter:creator" content="@JuanMedinaCode">
  <meta name="twitter:domain" content="http://juan-medina.com">
  <meta property="twitter:image" content="http://juan-medina.com/assets/img/openwhiskkotlin.png">

  <!-- ****** faviconit.com favicons ****** -->
  <link rel="shortcut icon" href="/favicon/favicon.ico">
  <link rel="icon" sizes="16x16 32x32 64x64" href="/favicon/favicon.ico">
  <link rel="icon" type="image/png" sizes="196x196" href="/favicon/favicon-192.png">
  <link rel="icon" type="image/png" sizes="160x160" href="/favicon/favicon-160.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96.png">
  <link rel="icon" type="image/png" sizes="64x64" href="/favicon/favicon-64.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16.png">
  <link rel="apple-touch-icon" href="/favicon/favicon-57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon/favicon-114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon/favicon-72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon/favicon-144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon/favicon-60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon/favicon-120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon/favicon-76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon/favicon-152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/favicon-180.png">
  
  <meta name="msapplication-TileColor" content="#FFFFFF">
  <meta name="msapplication-TileImage" content="/favicon-144.png">
  <meta name="msapplication-config" content="/browserconfig.xml">
  <!-- ****** faviconit.com favicons ****** -->

  <link type="application/atom+xml" rel="alternate" href="http://juan-medina.com/feed.xml" title="Juan Medina Personal Blog" />

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata|Lora|Space+Mono:700">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">

  <link rel="alternate" type="application/rss+xml" title="Juan Medina Personal Blog" href="http://juan-medina.com/feed.xml">
  <link rel="canonical" href="http://juan-medina.com/2017/07/21/kotlin-serverless/">


  <script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
  <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>

  
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-71726617-1', 'auto');
      ga('send', 'pageview');
    </script>
  

  <script type="text/javascript" class="init">
    $(document).ready(function() {
      $('.data-table').DataTable( {
        "paging"    : false,
        "info"      : false,
        "searching" : false,
      } );
    });
  </script>
    
</head>

  <body>

    <main>
      <article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="section-padding--lg mast rellax" data-rellax-speed="-4">
    <a class="nav nav--white" href="/">
      <i class="fa fa-lg fa-arrow-left"></i>
      <span>Back to Posts</span>
    </a>
    <figure class="absolute-bg mast__img" style="background-image: url('/assets/img/openwhiskkotlin.png');"></figure>
    <div class="mast__container">
      <span><time datetime="2017-07-21T22:00:00+01:00" itemprop="datePublished">Jul 21, 2017</time></span>
      <h1 itemprop="name headline">Serverless Kotlin</h1>
      
        <span>Posted in
          
            <a class="nav--white" href="/category/programming">Programming</a>
          
        </span>
      
      <span></span>
    </div>
  </header>

  <section class="section-padding bg-grey" itemprop="articleBody">
    <div class="post">
      <p>Right now there is a lot of traction on the Serverless architecture so I decide to give a try and do some examples using Kotlin.</p>

<p>The full source of this post it’s available in this <a href="https://github.com/LearningByExample/KotlinServerless" target="_blank">repository</a>.</p>

<p>First I recommend to read this <a href="https://martinfowler.com/articles/serverless.html" target="_blank">article</a> by <a href="https://twitter.com/mikebroberts" target="_blank">Mike Roberts</a> from Martin Fowler website to get a bit more understanding on what is a Serverless architecture.</p>

<p>Them we should take a loot to the <a href="https://github.com/apache/incubator-openwhisk/blob/master/docs/about.md" target="_blank">System Overview</a> of <a href="http://openwhisk.incubator.apache.org/" target="_blank">Apache Openwhisk</a>.</p>

<p>So now let starting to preparing our platform, we will require <a href="http://vagrantup.com/" target="_blank">Vagrant</a> and <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank">Virtual Box</a>, so install those first.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span>git clone <span class="nt">--depth</span><span class="o">=</span>1 https://github.com/apache/incubator-openwhisk.git openwhisk
  <span class="nv">$ </span><span class="nb">cd </span>openwhisk/tools/vagrant
  <span class="nv">$ </span>./hello</code></pre></figure>

<p>This will take a considerable amount of time so wait until everything is completed.</p>

<p>Now to test that the installation work we could just:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span>vagrant ssh <span class="nt">--</span> wsk action invoke /whisk.system/utils/echo <span class="nt">-p</span> message hello <span class="nt">--result</span></code></pre></figure>

<p>This will output:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">  </span><span class="p">{</span><span class="w">
      </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hello"</span><span class="w">
  </span><span class="p">}</span></code></pre></figure>

<p>Now we could stop our Whisk server anytime with:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span>vagrant <span class="nb">suspend</span></code></pre></figure>

<p>And bring it back with:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span>vagrant up</code></pre></figure>

<p>Now let’s create a simple Kotlin function:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">  <span class="k">fun</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">numbers</span><span class="p">:</span> <span class="nc">Long</span><span class="p">):</span> <span class="nc">Array</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">numbers</span> <span class="p">==</span> <span class="m">0L</span><span class="p">)</span> <span class="k">return</span> <span class="nf">arrayOf</span><span class="p">(</span><span class="m">0L</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">numbers</span> <span class="p">==</span> <span class="m">1L</span><span class="p">)</span> <span class="k">return</span> <span class="nf">arrayOf</span><span class="p">(</span><span class="m">1L</span><span class="p">)</span>

    <span class="kd">var</span> <span class="py">previous</span> <span class="p">=</span> <span class="m">1L</span>
    <span class="kd">var</span> <span class="py">current</span> <span class="p">=</span> <span class="m">1L</span>
    <span class="kd">var</span> <span class="py">temp</span><span class="p">:</span> <span class="nc">Long</span>

    <span class="k">return</span> <span class="nf">arrayOf</span><span class="p">(</span><span class="m">1L</span><span class="p">,</span> <span class="m">1L</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="m">1</span><span class="o">..</span><span class="p">(</span><span class="n">numbers</span> <span class="p">-</span> <span class="m">2</span><span class="p">)).</span><span class="nf">map</span> <span class="p">{</span>
      <span class="n">temp</span> <span class="p">=</span> <span class="n">current</span> <span class="p">+</span> <span class="n">previous</span>
      <span class="n">previous</span> <span class="p">=</span> <span class="n">current</span>
      <span class="n">current</span> <span class="p">=</span> <span class="n">temp</span>
      <span class="n">current</span>
    <span class="p">}.</span><span class="nf">toList</span><span class="p">().</span><span class="nf">toTypedArray</span><span class="p">()</span>
  <span class="p">}</span></code></pre></figure>

<p>This function just calculate a set of Fibonacci numbers, let try it out:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">  <span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nc">Array</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;)</span> <span class="p">=</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="m">5</span><span class="p">).</span><span class="nf">forEach</span><span class="p">(</span><span class="o">::</span><span class="n">println</span><span class="p">)</span></code></pre></figure>

<p>This should output:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">  <span class="m">1</span>
  <span class="m">1</span>
  <span class="m">2</span>
  <span class="m">3</span>
  <span class="m">5</span></code></pre></figure>

<p>But how we could convert this into a Serverless function?</p>

<p>First we need to create a main function as OpenWhisk will be able to understand :</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">  <span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nc">JsonObject</span><span class="p">)</span> <span class="p">:</span> <span class="nc">JsonObject</span> <span class="p">{</span>

  <span class="p">}</span></code></pre></figure>

<p>OpenWhisk use <a href="https://github.com/google/gson" target="_blank">Google GSon</a> so we will use in the final project maven to package our jar with dependencies, but for now let’s concentrate in the code, but the pom could be see <a href="https://github.com/LearningByExample/KotlinServerless/blob/master/pom.xml" target="_blank">here</a>.</p>

<p>OpenWhisk will sent to our function as many parameters as we define when we create our function, so for this I’ll need a parameters called <em>numbers</em>.</p>

<p>We could get the value with a simple extension function:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">  <span class="k">fun</span> <span class="nc">JsonObject</span><span class="p">.</span><span class="nf">paramOrElse</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">elseValue</span><span class="p">:</span> <span class="nc">Long</span><span class="p">):</span> <span class="nc">Long</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">has</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">getAsJsonPrimitive</span><span class="p">(</span><span class="n">name</span><span class="p">).</span><span class="n">asLong</span> <span class="k">else</span> <span class="n">elseValue</span></code></pre></figure>

<p>So now in our main function we could do something like :</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">  <span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nc">JsonObject</span><span class="p">)</span> <span class="p">:</span> <span class="nc">JsonObject</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">numbers</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">paramOrElse</span><span class="p">(</span><span class="s">"numbers"</span><span class="p">,</span> <span class="m">10L</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">results</span> <span class="p">=</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
  <span class="p">}</span></code></pre></figure>

<p>All so now we need to get a result so we could do something like:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">  <span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nc">JsonObject</span><span class="p">)</span> <span class="p">:</span> <span class="nc">JsonObject</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">numbers</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">paramOrElse</span><span class="p">(</span><span class="s">"numbers"</span><span class="p">,</span> <span class="m">10L</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">results</span> <span class="p">=</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">response</span> <span class="p">=</span> <span class="nc">JsonObject</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">elements</span> <span class="p">=</span> <span class="nc">JsonArray</span><span class="p">()</span>
    <span class="n">results</span><span class="p">.</span><span class="nf">forEach</span><span class="p">{</span> <span class="n">elements</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s">"result"</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>
  <span class="p">}</span></code></pre></figure>

<p>This look OK but I think we could improve adding just one extension function:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">  <span class="k">fun</span> <span class="nc">Long</span><span class="p">.</span><span class="nf">throughFunction</span><span class="p">(</span><span class="n">operation</span><span class="p">:</span> <span class="p">(</span><span class="nc">Long</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">Array</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">&gt;):</span> <span class="nc">JsonObject</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nc">JsonObject</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">elements</span> <span class="p">=</span> <span class="nc">JsonArray</span><span class="p">()</span>
    <span class="nf">operation</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">forEach</span><span class="p">(</span><span class="n">elements</span><span class="o">::</span><span class="n">add</span><span class="p">)</span>
    <span class="n">result</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s">"result"</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
  <span class="p">}</span></code></pre></figure>

<p>With this our main could become just:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">  <span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nc">JsonObject</span><span class="p">)</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">paramOrElse</span><span class="p">(</span><span class="s">"numbers"</span><span class="p">,</span> <span class="m">10L</span><span class="p">).</span><span class="nf">throughFunction</span><span class="p">(</span><span class="o">::</span><span class="n">fibonacci</span><span class="p">)</span></code></pre></figure>

<p>Let put all the parts together :</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">  <span class="k">package</span> <span class="nn">org.learning.by.example.serverless.kotlin</span>

  <span class="k">import</span> <span class="nn">com.google.gson.JsonArray</span>
  <span class="k">import</span> <span class="nn">com.google.gson.JsonObject</span>

  <span class="k">fun</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">numbers</span><span class="p">:</span> <span class="nc">Long</span><span class="p">):</span> <span class="nc">Array</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">numbers</span> <span class="p">==</span> <span class="m">0L</span><span class="p">)</span> <span class="k">return</span> <span class="nf">arrayOf</span><span class="p">(</span><span class="m">0L</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">numbers</span> <span class="p">==</span> <span class="m">1L</span><span class="p">)</span> <span class="k">return</span> <span class="nf">arrayOf</span><span class="p">(</span><span class="m">1L</span><span class="p">)</span>

    <span class="kd">var</span> <span class="py">previous</span> <span class="p">=</span> <span class="m">1L</span>
    <span class="kd">var</span> <span class="py">current</span> <span class="p">=</span> <span class="m">1L</span>
    <span class="kd">var</span> <span class="py">temp</span><span class="p">:</span> <span class="nc">Long</span>

    <span class="k">return</span> <span class="nf">arrayOf</span><span class="p">(</span><span class="m">1L</span><span class="p">,</span> <span class="m">1L</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="m">1</span><span class="o">..</span><span class="p">(</span><span class="n">numbers</span> <span class="p">-</span> <span class="m">2</span><span class="p">)).</span><span class="nf">map</span> <span class="p">{</span>
      <span class="n">temp</span> <span class="p">=</span> <span class="n">current</span> <span class="p">+</span> <span class="n">previous</span>
      <span class="n">previous</span> <span class="p">=</span> <span class="n">current</span>
      <span class="n">current</span> <span class="p">=</span> <span class="n">temp</span>
      <span class="n">current</span>
    <span class="p">}.</span><span class="nf">toList</span><span class="p">().</span><span class="nf">toTypedArray</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nc">JsonObject</span><span class="p">.</span><span class="nf">paramOrElse</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">elseValue</span><span class="p">:</span> <span class="nc">Long</span><span class="p">):</span> <span class="nc">Long</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">has</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">getAsJsonPrimitive</span><span class="p">(</span><span class="n">name</span><span class="p">).</span><span class="n">asLong</span> <span class="k">else</span> <span class="n">elseValue</span>

  <span class="k">fun</span> <span class="nc">Long</span><span class="p">.</span><span class="nf">throughFunction</span><span class="p">(</span><span class="n">operation</span><span class="p">:</span> <span class="p">(</span><span class="nc">Long</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">Array</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">&gt;):</span> <span class="nc">JsonObject</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nc">JsonObject</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">elements</span> <span class="p">=</span> <span class="nc">JsonArray</span><span class="p">()</span>
    <span class="nf">operation</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">forEach</span><span class="p">(</span><span class="n">elements</span><span class="o">::</span><span class="n">add</span><span class="p">)</span>
    <span class="n">result</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s">"result"</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nc">JsonObject</span><span class="p">)</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">paramOrElse</span><span class="p">(</span><span class="s">"numbers"</span><span class="p">,</span> <span class="m">10L</span><span class="p">).</span><span class="nf">throughFunction</span><span class="p">(</span><span class="o">::</span><span class="n">fibonacci</span><span class="p">)</span></code></pre></figure>

<p>With this prototype we could create many functions, in fact with a couple of generics could get even better but let’s do that another day.</p>

<p>So now we need to compile our function, since latter we will use vagrant is better that we put our project in the OpenWhisk folder created at the beginning of the post
since it will be map into the OpenWhisk machine.</p>

<p>I’ve create mine under openwhisk/projects/KotlinServerless and I’ll use maven wrapper</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span><span class="nb">cd </span>openwhisk
  <span class="nv">$ </span><span class="nb">cd </span>projects/KotlinServerless
  <span class="nv">$ </span>mvnw package</code></pre></figure>

<p>Now get back into the vagrant directory and ssh into the OpenWhisk machine:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span><span class="nb">cd </span>openwhisk
  <span class="nv">$ </span><span class="nb">cd </span>tools/vagrant
  <span class="nv">$ </span>vagrant ssh</code></pre></figure>

<p>Now from the OpenWhisk machine we will get into our function directory:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span><span class="nb">cd </span>openwhisk/projects/KotlinServerless/target
  <span class="nv">$ </span>wsk action create Fibonacci KotlinServerless-1.0-SNAPSHOT-jar-with-dependencies.jar <span class="nt">--main</span> <span class="se">\</span>
  org.learning.by.example.serverless.kotlin.FibonacciKt

  ok: created action Fibonacci</code></pre></figure>

<p>We need to specify the full location of our class, and remember than an static method in Kotlin get created in a class named _FileName_Kt.class</p>

<p>Now let’s run our function:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span>wsk action invoke <span class="nt">--result</span> Fibonacci <span class="nt">--param</span> numbers 5</code></pre></figure>

<p>And we will get as output something like:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">  </span><span class="p">{</span><span class="w">
      </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="mi">1</span><span class="p">,</span><span class="w">
          </span><span class="mi">1</span><span class="p">,</span><span class="w">
          </span><span class="mi">2</span><span class="p">,</span><span class="w">
          </span><span class="mi">3</span><span class="p">,</span><span class="w">
          </span><span class="mi">5</span><span class="w">
      </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span></code></pre></figure>

<p>And of course we could running without parameters as:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span>wsk action invoke <span class="nt">--result</span> Fibonacci</code></pre></figure>

<p>And the result will be:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">  </span><span class="p">{</span><span class="w">
      </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="mi">1</span><span class="p">,</span><span class="w">
          </span><span class="mi">1</span><span class="p">,</span><span class="w">
          </span><span class="mi">2</span><span class="p">,</span><span class="w">
          </span><span class="mi">3</span><span class="p">,</span><span class="w">
          </span><span class="mi">5</span><span class="p">,</span><span class="w">
          </span><span class="mi">8</span><span class="p">,</span><span class="w">
          </span><span class="mi">13</span><span class="p">,</span><span class="w">
          </span><span class="mi">21</span><span class="p">,</span><span class="w">
          </span><span class="mi">34</span><span class="p">,</span><span class="w">
          </span><span class="mi">55</span><span class="w">
      </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span></code></pre></figure>

<p>Finally don’t forget to suspend the vagrant machine after your done for the day, if not the OpenWhisk server sometimes get in bad state.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span>vagrant <span class="nb">suspend</span></code></pre></figure>

<p>You could get it back simply with:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span>vagrant up</code></pre></figure>

<p>I think this is enough for today, let’s see what else we do another day with this interesting topic.</p>

    

    <div id="disqus_thread"></div>
    <script>

    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

    var disqus_config = function () {
    this.page.url = "https://juan-medina.com/2017/07/21/kotlin-serverless/";
    this.page.identifier = "/2017/07/21/kotlin-serverless/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    this.page.title = "Serverless Kotlin";
    };

    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//juan-medina-com.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    

    </div>
  </section>

  <section class="profile">
    <div class="profile__card">
      <div class="profile__img">
        <figure class="absolute-bg" style="background-image: url('/assets/img/pp.jpg');"></figure>
      </div>
      <div class="profile__container">
        <p><b>About Juan Medina</b><br/> I'm just a normal geek that code all kind of stuff, from complex corporate applications to games.<br/> <br/> Games, music, movies and traveling are my escape pods.</p>
        
          <ul class="profile__social">
            
              <li><a class="fa fa-lg fa-envelope-o" href="mailto:mail@juan-medina.com"></a></li>
            
            
              <li><a class="fa fa-lg fa-address-card" href="https://juan-medina.com/cv" target="_blank"></a></li>
            
              <li><a class="fa fa-lg fa-github" href="https://github.com/juan-medina" target="_blank"></a></li>
            
              <li><a class="fa fa-lg fa-twitter" href="https://twitter.com/JuanMedinaCode" target="_blank"></a></li>
            
              <li><a class="fa fa-lg fa-stack-overflow" href="http://stackoverflow.com/users/7910403/juan-medina" target="_blank"></a></li>
            
          </ul>
        
      </div>
    </div>
  </section>

</article>


  <section class="next">
    <a class="next__link" href="/2017/07/01/moderncppci/" style="background-image: url('/assets/img/cpp_core_guidelines_logo.svg');">
      <div class="next__container">
        <span>Read Next</span>
        <h2>Modern C++ CI</h2>
      </div>
    </a>
  </section>


    </main>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/rellax/1.0.0/rellax.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
<script type="text/javascript" src="/assets/js/app.js"></script>


  </body>

</html>
